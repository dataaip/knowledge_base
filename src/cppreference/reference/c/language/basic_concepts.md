# C语言基础概念

来源：cppreference.com

## 基础概念概览

| 注释 | ASCII编码 | 字符集 | 翻译阶段 | 标点符号 |
|------|-----------|--------|----------|----------|
| ✅   | ✅        | ✅     | ✅       | ✅       |

| 标识符 | 作用域 | 生存期 | 查找与命名空间 | 类型 |
|--------|--------|--------|----------------|------|
| ✅     | ✅     | ✅     | ✅             | ✅   |

| 算术类型 | 对象与对齐 | main()函数 | as-if规则 | 未定义行为 |
|----------|------------|------------|-----------|------------|
| ✅       | ✅         | ✅         | ✅        | ✅         |

| 内存模型与数据竞争 |
|--------------------|
| ✅                 |

---

## 概念详解

### 一、C程序的本质

C程序是由一系列**文本文件**（通常包括头文件和源文件）组成的，这些文件中包含了各种**声明**（declarations）。这些文本文件需要经过**翻译过程**（translation），最终生成一个可执行程序。

生成的可执行程序在运行时，操作系统会调用其**main函数**作为程序入口点。但有一种特殊情况是**独立式程序**（freestanding program），如操作系统或嵌入式程序等，其入口点由具体实现决定。

> 💡 **术语解释：freestanding程序**
>
> 独立式程序是指不依赖标准库或运行时环境的程序。常见例子包括：
> - 操作系统内核
> - 嵌入式系统程序
> - 裸机程序（bare-metal program）
>
> 在这类程序中，main函数可能不存在，或者不是程序入口点。

---

### 二、标识符与关键字

C程序中的词汇可分为两类：

#### 1. **关键字**（Keywords）
具有**特殊含义**的保留字，不能作为标识符使用。

例如：
```c
int, if, else, for, while, return, sizeof, typedef, struct, union
```

#### 2. **标识符**（Identifiers）
可用于命名变量、函数、结构体标签、枚举值、类型别名等的名称。

##### ✅ 合法标识符命名规则：
- 必须以字母（`a-z`, `A-Z`）或下划线 `_` 开头
- 后续字符可包含数字 `0-9`
- 区分大小写（Case-sensitive）
- 不能是关键字

> 📌 示例：
```c
// 合法标识符
myVariable
MAX_SIZE
_getData
user123name

// 非法标识符
123var      // 不能以数字开头
int         // 关键字
my-variable // 包含非法字符 `-`
```

---

### 三、作用域与命名空间

每个标识符都有其**有效范围**（scope），即在程序中可以访问它的区域。

#### 四种作用域类型：

1. **块作用域**（block scope）  
   在 `{}` 内部声明的变量仅在此块内可见。
   
   ```c
   void func() {
       int x = 10;     // x的作用域从这里开始
       {
           int y = 20; // y仅在此块中可见
       }               // y超出作用域
   }                   // x超出作用域
   ```

2. **文件作用域**（file scope）  
   在任何函数之外定义的标识符，在整个文件中都可见（除非被隐藏）。

   ```c
   static int global_var = 100; // 文件作用域
   ```

3. **函数作用域**（function scope）  
   仅适用于**标签**（label），在函数内部任何位置都可以跳转到该标签。

   ```c
   void example() {
       goto label;     // 可以跳转到下面的label
   label:
       return;
   }
   ```

4. **函数原型作用域**（function prototype scope）  
   出现在函数参数列表中的标识符，只在其所在的函数原型中有效。

   ```c
   void func(int a, int b); // a和b的作用域仅限此行
   ```

---

### 四、生存期（Lifetime）

对象的存在时间分为以下几种：

1. **静态生存期**（static lifetime）  
   全局变量和静态局部变量在其程序运行期间一直存在。

2. **自动生存期**（automatic lifetime）  
   局部变量（未加 static）在进入其作用域时创建，退出时销毁。

3. **动态分配生存期**（allocated lifetime）  
   通过 `malloc`、`calloc` 等分配的内存，在调用 `free` 前一直有效。

---

### 五、类型系统（Type System）

C语言中每个**对象、函数、表达式**都有关联的类型。

#### 1. **算术类型**（Arithmetic Types）
包括整数类型和浮点类型：

| 整数类型          | 浮点类型        |
|-------------------|----------------|
| char              | float          |
| short             | double         |
| int               | long double    |
| long              |                |
| long long         |                |
| _Bool (C99起)     |                |

> 📌 示例：
```c
char c = 'A';
int i = 100;
float f = 3.14f;
double d = 2.71828;
```

#### 2. **派生类型**
- 指针类型：`int *p;`
- 数组类型：`int arr[10];`
- 结构体/联合体：`struct Point { int x, y; };`
- 函数类型：`int add(int a, int b);`

---

### 六、对象（Object）与对齐（Alignment）

在C语言中，“对象”是一个抽象概念，指**具有一定类型和大小的数据存储区域**。

每个对象都有对齐要求，以保证访问效率和正确性。

> 🧠 知识补充：
>
> - `alignof`（C11引入）可查询类型的对齐要求
> - `_Alignas` 可自定义对象对齐方式
>
> ```c
> #include <stdalign.h>
> 
> _Alignas(16) char aligned_buffer[256]; // 16字节对齐
> ```

---

### 七、main函数

每个宿主环境下的C程序都必须包含一个名为 `main` 的函数，它是程序的入口点。

标准形式：
```c
int main(void) { ... }
// 或
int main(int argc, char *argv[]) { ... }
```

---

### 八、as-if规则

这是C语言的一个重要编译优化原则：只要程序的行为保持不变，编译器可以自由优化代码，即使这意味着实际执行的指令与源码不同。

> 🧪 示例：空循环优化
```c
for (int i = 0; i < 1000000; ++i)
    ; // 空循环体
```
如果编译器能判断这个循环不产生副作用，则可能完全优化掉它。

---

### 九、未定义行为（Undefined Behavior）

这是C语言中极具风险的概念：当程序执行了**标准未定义其行为的操作**时，结果是不可预测的。

> ⚠️ 常见未定义行为示例：
```c
int a[10];
a[15] = 5;        // 数组越界访问（UB）

int *p = NULL;
*p = 42;          // 解引用空指针（UB）

int x = INT_MAX;
x++;              // 整数溢出（有符号整数）（UB）
```

> 🔍 深度理解：
>
> 未定义行为可能导致：
> - 程序崩溃
> - 安全漏洞（缓冲区溢出攻击）
> - 编译器优化导致逻辑错误
> - 在不同平台表现不一致

---

### 十、内存模型与数据竞争

现代C语言（特别是C11及以后）引入了多线程支持，并定义了并发环境下的内存模型。

#### 数据竞争（Data Race）
多个线程同时访问同一内存地址，且至少有一个是写操作，而没有适当的同步机制。

> 🧪 示例（导致数据竞争）：
```c
int counter = 0;

void increment() {
    counter++; // 多线程环境下非原子操作
}
```

> ✅ 正确做法：
```c
#include <stdatomic.h>
atomic_int counter = 0;

void increment() {
    atomic_fetch_add(&counter, 1);
}
```

---

## 相关资源链接

| 页 面                  | 内 容                           |
|------------------------|----------------------------------|
| [C++ 基础概念文档]     | C++语言基础概念对照学习         |

---

## 页面信息

- 来源地址：<https://en.cppreference.com/mwiki/index.php?title=c/language/basic_concepts&oldid=133988>
- 最后修改时间：2021年10月1日 00:44
- 离线版本获取时间：2025年2月9日 16:39

--- 

✅ 掌握C语言基础概念，是理解和编写高质量C代码的根基。尤其需要注意**作用域、类型系统、生存期、以及未定义行为**等核心概念，它们直接影响代码的安全性与健壮性。