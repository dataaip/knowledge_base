# C++ 基础概念

来源：cppreference.com

## 基础概念概览

| 注释       | ASCII编码         | 标点符号      | 名称与标识符     | 类型         |
|------------|-------------------|---------------|------------------|--------------|
| ✅         | ✅                | ✅            | ✅               | ✅           |

| 基本类型     | 对象              | 作用域        | 对象生存期       | 存储持续期与链接性 |
|--------------|-------------------|---------------|------------------|---------------------|
| ✅           | ✅                | ✅            | ✅               | ✅                  |

| 定义与ODR    | 名称查找         | 限定名称查找  | 非限定名称查找   | as-if 规则       |
|--------------|------------------|---------------|------------------|------------------|
| ✅           | ✅               | ✅            | ✅               | ✅               |

| 未定义行为   | 内存模型         | 多线程执行与数据竞争(C++11) | 字符集与编码 | 翻译阶段       |
|--------------|------------------|------------------------------|----------------|----------------|
| ✅           | ✅               | ✅                           | ✅             | ✅             |

| main函数     | 模块(C++20)      |
|--------------|------------------|
| ✅           | ✅               |

---

## 概念详解

### 一、C++ 程序的本质

C++ 程序是一系列**文本文件**（通常包括头文件和源文件）的集合，文件中包含各种**声明**（declarations）。这些文本文件需要经过**翻译过程**（translation），最终生成可执行程序，由 C++ 实现调用其 `main` 函数来启动执行。

---

### 二、程序组成要素

#### 1. **关键字**（Keywords）
具有固定含义的保留字，不能用作标识符。

#### 2. **标识符**（Identifiers）
可用于命名变量、函数、类等实体的名称。

#### 3. **注释**（Comments）
在翻译过程中被忽略，不影响程序执行。

#### 4. **字面量**（Literals）
表示具体值的数据，如数字、字符串等。

#### 5. **字符集与编码**
程序中字符的值由字符集和编码方式决定。

#### 6. **转义序列**（Escape Sequences）
某些特殊字符需通过转义表示，如 `\n`、`\t`。

---

### 三、C++ 程序实体（Entities）

程序中的基本构成单位，包括：

| 实体类型                   | 描述说明                                 |
|----------------------------|------------------------------------------|
| 值（Values）               | 表达式求值结果                           |
| 对象（Objects）            | 占据内存的变量实例                       |
| 引用（References）         | 已有对象的别名（C++ 特有）               |
| 结构化绑定（C++17）        | 将元组或结构体成员绑定到多个变量         |
| 函数（Functions）          | 执行特定任务的过程                       |
| 枚举值（Enumerators）      | 枚举类型的命名常量                       |
| 类型（Types）              | 数据结构和操作规则                       |
| 类成员（Class Members）    | 类中的变量、函数、类型等                 |
| 模板（Templates）          | 通用编程的工具                           |
| 模板特化（Specializations）| 模板的具体化实现                         |
| 参数包（Packs, C++11）     | 可变参数模板中使用的参数集合             |
| 命名空间（Namespaces）     | 组织标识符避免命名冲突                   |

> ❗ **注意**：
> - **预处理器宏**（如 `#define`）不属于 C++ 实体范畴。
> - 它们在预处理阶段展开，不在 C++ 语义分析范围内。

---

### 四、声明与定义

#### 1. **声明**（Declarations）
用于引入实体、关联名称并定义其属性。

#### 2. **定义**（Definitions）
提供实体使用所需的所有属性的声明。

> 📘 **ODR（One Definition Rule）单一定义规则**
>
> - 程序中每个**非内联函数**或**odr-used 的变量**只能有一个定义。
> - odr-used 指在需要其地址或大小的地方使用变量。

---

### 五、语句与表达式

#### 1. **函数定义**
通常包括一系列**语句**（Statements），其中可能包含**表达式**（Expressions），用于指定程序执行的计算。

---

### 六、名称查找与作用域

#### 1. **名称查找**（Name Lookup）
程序中遇到的名称通过声明查找机制与引入该名称的声明绑定。

#### 2. **作用域**（Scope）
每个名称只在其作用域内有效。

#### 3. **链接性**（Linkage）
具有外部链接性的名称可在不同作用域或翻译单元中引用同一实体。

##### 三种链接类型：

- **外部链接**（External Linkage）  
  可在多个翻译单元间共享
- **内部链接**（Internal Linkage）  
  仅在当前翻译单元可见（如 static 函数/变量）
- **无链接**（No Linkage）  
  仅在局部作用域内有效（如局部变量）

---

### 七、类型系统（Type System）

C++ 中的每个对象、引用、函数、表达式都有关联的类型。

#### 三大类类型：

| 类型类别     | 子类说明                                               |
|--------------|---------------------------------------------------------|
| 基本类型     | int, double, char 等内置类型                             |
| 复合类型     | 指针、数组、引用、函数类型等                            |
| 用户定义类型 | class, struct, union, enum 等                          |

#### 类型状态分类：

- **完整类型**（Complete Type）  
  编译器已知其完整定义和大小的类型
- **不完整类型**（Incomplete Type）  
  仅声明未定义的类型（如 forward declaration）

---

### 八、变量（Variables）

满足以下条件的声明对象或引用称为变量：

- 是**声明的对象**或**声明的引用**
- 不是非静态数据成员

> 📌 示例：
```cpp
int global_var;       // 变量（文件作用域）
void func() {
    int local_var;    // 变量（块作用域）
    static int s_var; // 变量（静态局部）
}
```

---

## 扩展知识详解

### 一、作用域详解

作用域决定了标识符的有效范围：

| 作用域类型       | 说明                                                         |
|------------------|--------------------------------------------------------------|
| 块作用域         | `{}` 内部声明，退出块即失效                                   |
| 文件作用域       | 函数外部声明，整个文件可见                                   |
| 函数作用域       | 仅适用于标签（label），可跨块跳转                            |
| 函数原型作用域   | 函数参数列表中声明，仅限于函数原型                           |
| 类作用域         | 类成员名在类定义内部有效                                     |
| 命名空间作用域   | 在命名空间内定义的名称                                       |

---

### 二、存储持续期（Storage Duration）

决定了对象的生命周期：

| 持续期类型     | 特征说明                                           |
|----------------|----------------------------------------------------|
| 自动存储期     | 局部变量，默认方式，进入块创建，退出块销毁       |
| 静态存储期     | 全局/静态变量，在程序运行期间存在                 |
| 线程存储期     | thread_local 存储期（C++11起）                    |
| 动态分配存储期 | 使用 new/malloc 分配的内存，手动管理生命周期     |

---

### 三、as-if 规则

编译器可在不影响程序行为的前提下自由优化，即使优化后的指令与源码不同。

> 🧪 示例：
```cpp
int func() {
    int x = 10;
    return x + 5;  // 编译器可优化为 return 15;
}
```

---

### 四、未定义行为（Undefined Behavior）

当程序执行了标准未定义其行为的操作，结果不可预测。

> ⚠️ 典型未定义行为：
```cpp
int *p = nullptr;
*p = 42;         // 解引用空指针
int a[10];
a[15] = 5;       // 越界访问
int x = INT_MAX;
x++;             // 有符号整数溢出
```

---

### 五、内存模型（Memory Model）

自 C++11 引入多线程支持后，定义了并发环境下内存访问的规则。

#### 1. **原子操作**
提供无锁同步机制。

#### 2. **内存排序**
控制对多个内存操作的观察顺序。

#### 3. **数据竞争**
多个线程访问同一内存地址，至少一个写操作，且无同步。

> ✅ 正确处理方式：
```cpp
#include <atomic>
std::atomic<int> counter{0};

void increment() {
    counter.fetch_add(1);
}
```

---

### 六、模块（Modules, C++20）

取代传统头文件机制的新特性：

- 编译更快
- 避免宏污染
- 更好的封装性

> 📌 基本用法：
```cpp
// math.ixx
export module math;

export int add(int a, int b) {
    return a + b;
}

// main.cpp
import math;

int main() {
    int result = add(2, 3);  // 使用模块导入的函数
}
```

---

## 相关资源链接

| 页面名称                     | 内容说明                         |
|------------------------------|----------------------------------|
| [C 基础概念文档]             | C语言基础概念对比学习           |

---

## 页面信息

- 页面地址：<https://en.cppreference.com/mwiki/index.php?title=cpp/language/basic_concepts&oldid=178141>
- 最后修改时间：2024年12月3日 22:24
- 离线版本获取时间：2025年2月9日 16:39

--- 

✅ 掌握以上 C++ 基础概念对于理解高级特性、调试程序逻辑、避免常见错误至关重要。特别是**作用域、类型系统、未定义行为**等内容，直接关系到代码质量和系统稳定性。