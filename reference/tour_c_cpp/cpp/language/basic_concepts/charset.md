# C++ 语言字符集与编码详解

  [1. 概述与标准术语](#1-概述与标准术语)
  
  [2. 翻译字符集（Translation Character Set）](#2-翻译字符集translation-character-set)
  
  [3. 基本字符集（Basic Character Set）](#3-基本字符集basic-character-set)
  
  [4. 基本字面量字符集（Basic Literal Character Set）](#4-基本字面量字符集basic-literal-character-set)
  
  [5. 执行字符集与宽字符集](#5-执行字符集与宽字符集)
  
  [6. 代码单元与字面量编码](#6-代码单元与字面量编码)
  
  [7. 标准术语变更与兼容性](#7-标准术语变更与兼容性)
  
  [8. 缺陷报告与标准修订](#8-缺陷报告与标准修订)
  
  [9. 实践举例](#9-实践举例)
  
  [10. 参考资料](#10-参考资料)

## 1. 概述与标准术语

C++ 标准定义了多种字符集及其编码方式，涉及源代码的存储、翻译、执行等多个阶段。理解这些字符集对于跨平台开发、国际化和底层编程尤为重要。

---

## 2. 翻译字符集（Translation Character Set）

翻译字符集是 C++ 源代码在翻译阶段使用的字符集合：

- 每个抽象字符在 Unicode 代码空间中分配唯一代码点。
- 未分配给抽象字符的 Unicode 标量值也会指定独特字符。
- 翻译字符集是基本字符集和基本字面量字符集的超集。

> 自 C++23 起，翻译字符集的定义与 Unicode 标准紧密对齐。

---

## 3. 基本字符集（Basic Character Set）

### 3.1 组成

基本字符集包含 96 个字符（C++26 起为 99 个）：

| 代码点   | 字符 | 字形/说明 |
|----------|------|-----------|
| U+0009   | \t   | 制表符（Tab）|
| U+000B   | \v   | 垂直制表符（Vertical Tab）|
| U+000C   | \f   | 换页符（Form Feed, FF）|
| U+0020   |      | 空格 |
| U+000A   | \n   | 换行符（Line Feed, 新行）|
| U+0021   | !    | 感叹号 |
| U+0022   | "    | 双引号 |
| U+0023   | #    | 井号 |
| U+0025   | %    | 百分号 |
| U+0026   | &    | 和号 |
| U+0027   | '    | 单引号 |
| U+0028   | (    | 左括号 |
| U+0029   | )    | 右括号 |
| U+002A   | *    | 星号 |
| U+002B   | +    | 加号 |
| U+002C   | ,    | 逗号 |
| U+002D   | -    | 减号/连字符 |
| U+002E   | .    | 句号 |
| U+002F   | /    | 斜杠 |
| U+0030..U+0039 | 0..9 | 数字 0~9 |
| U+003A   | :    | 冒号 |
| U+003B   | ;    | 分号 |
| U+003C   | <    | 小于号 |
| U+003D   | =    | 等号 |
| U+003E   | >    | 大于号 |
| U+003F   | ?    | 问号 |
| U+0041..U+005A | A..Z | 大写字母 |
| U+005B   | [    | 左方括号 |
| U+005C   | \\   | 反斜杠 |
| U+005D   | ]    | 右方括号 |
| U+005E   | ^    | 脱字符 |
| U+005F   | _    | 下划线 |
| U+0061..U+007A | a..z | 小写字母 |
| U+007B   | {    | 左花括号 |
| U+007C   | |    | 竖线 |
| U+007D   | }    | 右花括号 |
| U+007E   | ~    | 波浪号 |

#### C++26 新增字符

| 代码点 | 字符 | 说明 |
|--------|------|------|
| U+0024 | $    | 美元符号 |
| U+0040 | @    | 商业 at |
| U+0060 | `    | 反引号 |

---

## 4. 基本字面量字符集（Basic Literal Character Set）

基本字面量字符集 = 基本字符集 + 以下控制字符：

| 代码点 | 字符 | 说明 |
|--------|------|------|
| U+0000 | \0   | 空字符（字符串结束）|
| U+0007 | \a   | 响铃 |
| U+0008 | \b   | 退格 |
| U+000D | \r   | 回车（Carriage Return）|

---

## 5. 执行字符集与宽字符集

执行字符集和执行宽字符集是基本字面量字符集的超集。其编码和附加元素集（如扩展字符）由实现和区域设置决定。

- 执行宽字符集中的每个元素都必须能表示为不同的 `wchar_t` 代码单元。

---

## 6. 代码单元与字面量编码

- **代码单元**：字符类型的整数值。
- **字面量编码**：根据编码前缀（如无前缀、L、u8、u、U）将字符映射为一个或多个代码单元。

### 6.1 普通与宽字面量编码

- 普通字面量编码：应用于普通字符/字符串字面量。
- 宽字面量编码：应用于宽字符/字符串字面量。

### 6.2 多字节编码（UTF-8/UTF-16/UTF-32）

对于带 `u8`、`u`、`U` 前缀的字面量，字符集中的每个字符按 ISO/IEC 10646 的 UCS 编码形式进行编码。

---

## 7. 标准术语变更与兼容性

C++23 通过 P2314R4 规范化了字符集相关术语：

| 新名称           | 旧名称           |
|------------------|------------------|
| 基本字符集       | 基本源字符集     |
| 基本字面量字符集 | 基本执行字符集   |
| 基本执行宽字符集 |                  |

自 C++23 起，源文件（非 UTF-8）到基本字符集（或转换字符集）的映射在转换阶段 1 由实现定义，需查阅具体编译器文档。

---

## 8. 缺陷报告与标准修订

| DR      | 应用于 | 已发布行为 | 正确行为 |
|---------|--------|------------|----------|
| CWG 788 | C++98  | 执行字符集的成员值原本是实现定义，但并非特定于区域设置 | 现为区域设置特定 |
| CWG 1796| C++98  | 基本执行（宽）字符集中空（宽）字符的表示所有位都是零 | 仅需值为零 |

---

## 9. 实践举例

### 9.1 判断字符是否为字母或数字

```cpp
#include <iostream>
#include <cctype>
int main() {
	char c = 'A';
	if (std::isalpha(c)) std::cout << "字母\n";
	if (std::isdigit(c)) std::cout << "数字\n";
	return 0;
}
```

### 9.2 字符编码与字符串

```cpp
#include <iostream>
int main() {
	std::string s = "Hello, 世界";
	std::cout << s << std::endl; // 可能因编码不同而输出不同
	return 0;
}
```

---

## 10. 参考资料

- ISO/IEC 14882:2020 (C++20) - Programming languages — C++
- cppreference.com
