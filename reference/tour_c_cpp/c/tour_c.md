# C 参考手册

## 参考手册

| 标题         | 内容                                                         |
| ------------ | ------------------------------------------------------------ |
| 语言标准     | C89, C95, C99, C11, C17, C23                                 |
| 编译器支持   | C99, C23                                                     |
| 语言概念     | 基础概念，关键字，预处理器，语句，表达式，声明，初始化，函数，杂项和习语 |
| 标准库头文件 | 语言支持库，通用实用程序库，诊断库，内存管理库，字符串库，日期和时间库，本地化库，输入/输出库，算法库，数字库，并发支持库 |
| 功能测试     | 功能测试宏，功能测试宏标头                                   |
| 技术规格     | 实验性-功能标准库扩展（库基础 TS），TR/TS 规格，非 TS 提案   |
| 有用资源     | C 常见问题，C 语言和库参考，C ABI，相关标准，开源实现，非 ANSI/ISO C库列表 |

---

### 语言标准

| 语言标准 | 内容                                                    |
| -------- | ------------------------------------------------------- |
| C89/C90  | 第一个正式标准                                          |
| C95      | C 语言标准的第一个修订版，对 C90 的小幅修订             |
| C99      | C 语言标准的第三个主要版本                              |
| C11      | C 语言标准的第六个主要版本                              |
| C17      | C 语言标准的第七个主要版本，对 C11 的维护修订，修复缺陷 |
| C23      | 当前最新的标准修订版                                    |

### 知识增强：语言标准详解

> C89/C90 是由美国国家标准协会（ANSI）于 1989 年发布的第一个正式 C 语言标准，随后 ISO 在 1990 年采纳并发布为 ISO/IEC 9899:1990，因此也称为 C90。该标准奠定了现代 C 语言的基础，包括基本语法、数据类型、控制结构等。
>
> C95 是对 C90 的一次小幅修订，主要增加了对宽字符（wide character）的支持，并修复了一些小错误。它并未引入新的语言特性，而是增强了国际化支持。
>
> C99 是 C 语言发展中的一个重要里程碑，引入了许多新特性，如：混合声明与代码（允许在代码块中任意位置声明变量）、新的数据类型（如 `_Bool`、`long long`）、复数类型（`_Complex`）、可变长度数组（VLA）、内联函数（`inline`）、单行注释（`//`）
>
> C11 引入了多线程支持、泛型选择（`_Generic`）、静态断言（`_Static_assert`）、匿名结构体/联合体等新特性，进一步增强了语言的功能性和安全性。
>
> C17 是对 C11 的一次维护性修订，主要目的是修复已知缺陷，未引入重大新特性。它是目前广泛使用的标准之一。
>
> C23 是当前最新的 C 语言标准，仍在发展中，预计将引入更多现代化特性，如改进的泛型支持、更好的错误处理机制等。
>

---

### 编译器支持

| 编译器支持 | 内容             |
| ---------- | ---------------- |
| C99        | GCC，Clang，MSVC |
| C23        | GCC，Clang，MSVC |

### 知识增强：编译器支持详解

> GCC 是一个开源的编译器套件，支持多种编程语言，包括 C 和 C++。它对 C 标准的支持非常全面，尤其是对 C99 和 C11 的支持较为成熟。GCC 还提供了许多扩展功能，如内联汇编、属性声明等。
>
> Clang 是 LLVM 项目的一部分，以其快速编译速度和优秀的错误提示而闻名。它对 C 标准的支持也非常出色，尤其是在 C11 和 C17 方面表现优异。Clang 的设计目标是替代 GCC，成为下一代主流编译器。
>
> MSVC 是微软开发的 C/C++ 编译器，主要用于 Windows 平台。虽然它对 C99 的支持相对较晚，但在 C11 和 C17 方面已经逐步完善。MSVC 提供了丰富的调试工具和集成开发环境（IDE），适合 Windows 开发者使用。
>

---

### 语言概念

| 概念       | 内容                                                         |
| ---------- | ------------------------------------------------------------ |
| 基础概念   | 注释，ASCII编码，字符集，翻译阶段，标点符号，标识符，作用域，生存期，查找与命名空间，类型，算术类型，对象与对齐，main()函数，as-if规则，未定义行为，内存模型与数据竞争 |
| 关键字     | 标准关键字，C99新增关键字，C11新增关键字，C23新增关键字，条件支持 asm, fortran |
| 预处理器   | 条件编译指令，宏定义指令，文件包含指令，错误控制指令，其他控制指令 |
| 语句       | 标签语句，表达式语句，复合语句，选择语句，迭代语句，跳转语句 |
| 表达式     | 通用概念，常量和字面量，运算符，转换，主表达式，特殊表达式   |
| 声明       | 类型说明符，存储类说明符，类型限定符，对齐说明符，初始值设定项，属性声明列表，声明定义重声明，声明符 |
| 初始化     | 显示初始化，隐式初始化，空初始化，标量初始化，数组初始化，结构体/联合体初始化 |
| 函数       | 函数声明，函数定义，可变参数，内联函数，_Noreturn            |
| 杂项和习语 | C 的历史，一致性，内联汇编，信号处理，可分析性               |

### 知识增强：语言概念详解

> **基础概念**
>
> - 注释：C 语言支持两种注释形式，分别是 `/* ... */`（多行注释）和 `//`（单行注释）。注释不会被编译器处理，仅用于提高代码的可读性。
> - ASCII编码：C 语言默认使用 ASCII 编码，每个字符对应一个唯一的数值。ASCII 编码范围为 0 到 127，涵盖了英文字母、数字和常用符号。
> - 字符集：C 语言支持多种字符集，包括 ASCII、ISO 8859-1 等。字符集的选择会影响程序的国际化支持。
> - 翻译阶段：C 语言的编译过程分为多个阶段，包括预处理、词法分析、语法分析、语义分析、优化和代码生成。每个阶段都有特定的任务，确保程序的正确性和高效性。
> - 标点符号：C 语言中的标点符号包括分号（`;`）、逗号（`,`）、括号（`()`）、花括号（`{}`）等，用于分隔语句、表达式和代码块。
> - 标识符：标识符是程序员定义的名称，用于标识变量、函数、类型等。标识符必须以字母或下划线开头，后面可以跟字母、数字或下划线。
> - 作用域：作用域决定了标识符在程序中的可见范围。C 语言中有四种作用域：文件作用域、函数作用域、块作用域和函数原型作用域。
> - 生存期：生存期决定了对象在程序运行期间的存在时间。C 语言中有三种生存期：静态生存期、自动生存期和动态生存期。
> - 查找与命名空间：C 语言中有多个命名空间，包括标签命名空间、成员命名空间、普通标识符命名空间等。不同的命名空间可以使用相同的标识符而不冲突。
> - 类型：C 语言支持多种数据类型，包括基本类型（如 `int`、`float`）、派生类型（如指针、数组、结构体）和用户自定义类型（如 `typedef`）。
> - 算术类型：算术类型包括整型（如 `int`、`long`）和浮点型（如 `float`、`double`）。它们用于表示数值数据。
> - 对象与对齐：对象是内存中的一个区域，用于存储数据。对齐是指对象在内存中的地址必须满足一定的对齐要求，以提高访问效率。
> - main()函数：`main()` 函数是 C 程序的入口点，程序从这里开始执行。它可以接受命令行参数，并返回一个整数值表示程序的退出状态。
> - as-if规则：as-if 规则允许编译器对程序进行优化，只要优化后的程序在行为上与原始程序相同即可。
> - 未定义行为：未定义行为是指程序的行为无法预测，可能引发错误或异常。常见的未定义行为包括访问空指针、除以零等。
> - 内存模型与数据竞争：内存模型定义了程序中各个线程如何访问共享内存。数据竞争是指多个线程同时访问同一内存位置且至少有一个线程进行写操作，可能导致不可预测的结果。
>
> **关键字**
>
> - 标准关键字：C 语言的标准关键字包括 `int`、`char`、`void`、`if`、`else`、`for`、`while`、`return` 等，它们具有特殊的含义，不能用作标识符。
> - C99 新增关键字：C99 引入了 `restrict`、`inline`、`_Bool` 等关键字，增强了语言的功能性。
> - C11 新增关键字：C11 引入了 `_Alignas`、`_Alignof`、`_Atomic`、`_Generic`、`_Noreturn`、`_Static_assert`、`_Thread_local` 等关键字，增强了语言的安全性和并发支持。
> - C23 新增关键字：C23 预计将引入更多关键字，如 `constexpr`、`typeof` 等，进一步增强语言的表达能力。
> - 条件支持 asm, fortran：这些关键字用于条件编译，允许在特定条件下启用或禁用某些代码段。
>
> **预处理器**
>
> - 条件编译指令：条件编译指令包括 `#if`、`#ifdef`、`#ifndef`、`#elif`、`#else`、`#endif`，用于根据条件选择性地编译代码。
> - 宏定义指令：宏定义指令包括 `#define` 和 `#undef`，用于定义和取消宏。宏可以是简单的替换，也可以是带参数的函数式宏。
> - 文件包含指令：文件包含指令 `#include` 用于将其他文件的内容插入到当前文件中，常用于包含头文件。
> - 错误控制指令：错误控制指令 `#error` 用于在编译时产生错误信息，常用于检测配置错误。
> - 其他控制指令：其他控制指令包括 `#pragma`、`#line` 等，用于控制编译器的行为。
>
> **语句**
>
> - 标签语句：标签语句用于标记代码中的某个位置，常用于 `goto` 语句。
> - 表达式语句：表达式语句是由一个表达式组成的语句，通常用于赋值或调用函数。
> - 复合语句：复合语句是由多个语句组成的代码块，用花括号 `{}` 包围。
> - 选择语句：选择语句包括 `if` 和 `switch`，用于根据条件选择执行不同的代码路径。
> - 迭代语句：迭代语句包括 `for`、`while` 和 `do-while`，用于重复执行代码块。
> - 跳转语句：跳转语句包括 `goto`、`break`、`continue` 和 `return`，用于改变程序的执行流程。
>
> **表达式**
>
> - 通用概念：表达式是由操作数和运算符组成的，用于计算值或执行操作。
> - 常量和字面量：常量是程序中不可改变的值，字面量是直接写在代码中的常量，如 `123`、`'A'`、`"Hello"`。
> - 运算符：运算符用于对操作数进行操作，包括算术运算符（如 `+`、`-`）、关系运算符（如 `==`、`!=`）、逻辑运算符（如 `&&`、`||`）等。
> - 转换：转换是指将一种类型的值转换为另一种类型，包括隐式转换和显式转换。
> - 主表达式：主表达式是最基本的表达式，包括标识符、常量、字符串字面量等。
> - 特殊表达式：特殊表达式包括条件表达式（`?:`）、逗号表达式（`,`）、赋值表达式（`=`）等。
>
> **声明**
>
> - 类型说明符：类型说明符用于指定变量或函数的类型，包括 `int`、`char`、`float`、`double` 等。
> - 存储类说明符：存储类说明符用于指定变量的存储方式，包括 `auto`、`register`、`static`、`extern` 等。
> - 类型限定符：类型限定符用于指定变量的属性，包括 `const`、`volatile`、`restrict` 等。
> - 对齐说明符：对齐说明符用于指定对象的对齐要求，包括 `_Alignas`。
> - 初始值设定项：初始值设定项用于初始化变量，可以是常量、表达式或函数调用。
> - 属性声明列表：属性声明列表用于指定变量或函数的属性，如 `__attribute__((aligned(16)))`。
> - 声明定义重声明：声明定义重声明用于重新声明已存在的变量或函数，常用于跨文件引用。
> - 声明符：声明符用于指定变量或函数的名称和类型，包括指针、数组、函数等。
>
> **初始化**
>
> - 显示初始化：显示初始化是指在声明变量时直接指定初始值，如 `int x = 10;`。
> - 隐式初始化：隐式初始化是指在声明变量时不指定初始值，由编译器自动初始化为默认值，如 `int x;`。
> - 空初始化：空初始化是指将变量初始化为空值，如 `int x = 0;`。
> - 标量初始化：标量初始化是指对单个变量进行初始化，如 `int x = 10;`。
> - 数组初始化：数组初始化是指对数组元素进行初始化，如 `int arr[] = {1, 2, 3};`。
> - 结构体/联合体初始化：结构体/联合体初始化是指对结构体或联合体成员进行初始化，如 `struct Point p = {10, 20};`。
>
> **函数**
>
> - 函数声明：函数声明用于告诉编译器函数的名称、返回类型和参数列表，如 `int add(int a, int b);`。
> - 函数定义：函数定义用于实现函数的具体功能，如 `int add(int a, int b) { return a + b; }`。
> - 可变参数：可变参数函数可以接受不定数量的参数，如 `printf` 函数。
> - 内联函数：内联函数用于减少函数调用的开销，通过 `inline` 关键字声明。
> - _Noreturn：`_Noreturn` 用于指示函数不会返回，如 `exit` 函数。
>
> **杂项和习语**
>
> - C 的历史：C 语言起源于 1970 年代，由 Dennis Ritchie 在贝尔实验室开发，最初用于编写 Unix 操作系统。
> - 一致性：一致性是指程序的行为符合 C 标准的要求，确保程序在不同平台上具有一致的表现。
> - 内联汇编：内联汇编允许在 C 代码中嵌入汇编代码，常用于性能优化或访问硬件资源。
> - 信号处理：信号处理用于处理程序运行时的异常情况，如中断、错误等。
> - 可分析性：可分析性是指程序的结构清晰，易于理解和维护。
>

---

### 标准库头文件

| 标准库         | 内容                                                         |
| -------------- | ------------------------------------------------------------ |
| 语言支持库     | 基本类型，附加基本类型和便利宏，固定宽度整数类型（C99起），数值限制 |
| 通用实用程序库 | 程序终止，不可达控制流，与环境通信，内存对齐查询，信号处理，非局部跳转 |
| 诊断库         | 错误码机制，断言机制，边界检查功能                           |
| 内存管理库     | 内存管理函数                                                 |
| 字符串库       | 字节字符串，多字节字符串，宽字符串                           |
| 日期和时间库   | 时间操作，格式转换，常量定义，类型定义                       |
| 本地化库       | 本地化支持函数，区域设置类别                                 |
| 输入/输出库    | 核心类型与对象，标准流对象，关键结构体与类型，宏常量，文件操作函数 |
| 算法库         | 排序，查找函数                                               |
| 数字库         | 常用数学函数，浮点环境，伪随机数生成，复数运算，泛型数学宏，位操作支持，安全整数运算 |
| 并发支持库     | 线程管理，原子操作，原子标志，内存排序，互斥量，条件变量，线程局部存储 |

### 知识增强：标准库头文件详解

> **语言支持库**
>
> - 基本类型：包括 `int`、`char`、`float`、`double` 等基本数据类型。
> - 附加基本类型和便利宏：包括 `size_t`、`ptrdiff_t`、`NULL` 等类型和宏，用于简化编程。
> - 固定宽度整数类型（C99起）：包括 `int8_t`、`int16_t`、`int32_t`、`int64_t` 等，确保在不同平台上具有固定的宽度。
> - 数值限制：包括 `INT_MAX`、`CHAR_MIN` 等宏，用于获取各种类型的取值范围。
>
> **通用实用程序库**
>
> - 程序终止：包括 `exit`、`abort` 等函数，用于终止程序的执行。
> - 不可达控制流：包括 `noreturn` 属性，用于指示函数不会返回。
> - 与环境通信：包括 `getenv`、`system` 等函数，用于与操作系统环境交互。
> - 内存对齐查询：包括 `_Alignof`、`aligned_alloc` 等函数，用于查询和分配对齐的内存。
> - 信号处理：包括 `signal`、`raise` 等函数，用于处理程序运行时的信号。
> - 非局部跳转：包括 `setjmp`、`longjmp` 等函数，用于实现非局部跳转。
>
> **诊断库**
>
> - 错误码机制：包括 `errno`、`strerror` 等函数，用于处理错误码。
> - 断言机制：包括 `assert` 宏，用于在调试时检查条件是否成立。
> - 边界检查功能：包括 `bounds_checking` 相关函数，用于防止缓冲区溢出。
>
> **内存管理库**
>
> - 内存管理函数：包括 `malloc`、`free`、`calloc`、`realloc` 等函数，用于动态分配和释放内存。
>
> **字符串库**
>
> - 字节字符串：包括 `strcpy`、`strlen`、`strcmp` 等函数，用于处理以字节为单位的字符串。
> - 多字节字符串：包括 `mblen`、`mbtowc`、`wctomb` 等函数，用于处理多字节字符。
> - 宽字符串：包括 `wcslen`、`wcscpy`、`wcscmp` 等函数，用于处理宽字符字符串。
>
> **日期和时间库**
>
> - 时间操作：包括 `time`、`clock` 等函数，用于获取当前时间和 CPU 时间。
> - 格式转换：包括 `strftime`、`asctime` 等函数，用于将时间转换为字符串。
> - 常量定义：包括 `CLOCKS_PER_SEC` 等常量，用于表示时间单位。
> - 类型定义：包括 `time_t`、`clock_t` 等类型，用于表示时间。
>
> **本地化库**
>
> - 本地化支持函数：包括 `setlocale`、`localeconv` 等函数，用于设置和查询本地化信息。
> - 区域设置类别：包括 `LC_ALL`、`LC_COLLATE`、`LC_CTYPE` 等宏，用于指定不同的本地化类别。
>
> **输入/输出库**
>
> - 核心类型与对象：包括 `FILE`、`stdin`、`stdout`、`stderr` 等类型和对象，用于文件操作。
> - 标准流对象：包括 `stdin`、`stdout`、`stderr`，分别表示标准输入、标准输出和标准错误。
> - 关键结构体与类型：包括 `fpos_t`、`off_t` 等类型，用于文件定位。
> - 宏常量：包括 `EOF`、`BUFSIZ` 等宏，用于表示文件结束和缓冲区大小。
> - 文件操作函数：包括 `fopen`、`fclose`、`fread`、`fwrite` 等函数，用于文件的打开、关闭、读取和写入。
>
> **算法库**
>
> - 排序：包括 `qsort` 函数，用于对数组进行排序。
> - 查找函数：包括 `bsearch` 函数，用于在有序数组中查找元素。
>
> **数字库**
>
> - 常用数学函数：包括 `sin`、`cos`、`sqrt` 等函数，用于数学计算。
> - 浮点环境：包括 `feholdexcept`、`feraiseexcept` 等函数，用于控制浮点运算环境。
> - 伪随机数生成：包括 `rand`、`srand` 等函数，用于生成伪随机数。
> - 复数运算：包括 `creal`、`cimag` 等函数，用于复数运算。
> - 泛型数学宏：包括 `fabs`、`fmax` 等宏，用于泛型数学运算。
> - 位操作支持：包括 `bit` 相关函数，用于位操作。
> - 安全整数运算：包括 `safe_add`、`safe_sub` 等函数，用于防止整数溢出。
>
> **并发支持库**
>
> - 线程管理：包括 `thrd_create`、`thrd_join` 等函数，用于创建和管理线程。
> - 原子操作：包括 `atomic_load`、`atomic_store` 等函数，用于原子操作。
> - 原子标志：包括 `atomic_flag_test_and_set`、`atomic_flag_clear` 等函数，用于原子标志操作。
> - 内存排序：包括 `memory_order` 相关宏，用于控制内存访问顺序。
> - 互斥量：包括 `mtx_lock`、`mtx_unlock` 等函数，用于互斥锁操作。
> - 条件变量：包括 `cnd_wait`、`cnd_signal` 等函数，用于条件变量操作。
> - 线程局部存储：包括 `tss_create`、`tss_get` 等函数，用于线程局部存储。
>

---

### 功能测试

| 功能测试   | 内容           |
| ---------- | -------------- |
| 功能测试宏 | 功能测试宏标头 |

### 知识增强：功能测试宏详解

> 功能测试宏用于检测编译器是否支持某些特定的功能或特性。常见的功能测试宏包括：
>
> - `__STDC_VERSION__`：用于检测 C 标准版本，如 `199901L` 表示 C99，`201112L` 表示 C11。
> - `__STDC_HOSTED__`：用于检测是否为宿主环境（即是否支持完整的标准库）。
> - `__STDC_UTF_16__`：用于检测是否支持 UTF-16 编码。
> - `__STDC_UTF_32__`：用于检测是否支持 UTF-32 编码。
> - `__STDC_IEC_559__`：用于检测是否支持 IEEE 754 浮点标准。
> - `__STDC_IEC_559_COMPLEX__`：用于检测是否支持复数运算。
> - `__STDC_NO_ATOMICS__`：用于检测是否不支持原子操作。
> - `__STDC_NO_COMPLEX__`：用于检测是否不支持复数类型。
> - `__STDC_NO_THREADS__`：用于检测是否不支持线程。
> - `__STDC_NO_VLA__`：用于检测是否不支持可变长度数组。
>

---

### 技术规格

| 实验性-功能                        | 内容                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| 实验性-功能标准库扩展（库基础 TS） | 嵌入式处理器的扩展，动态内存扩展，浮点扩展，TR/TS 规格，非 TS 提案 |

### 知识增强：技术规格详解

> **实验性-功能标准库扩展（库基础 TS）**
>
> - 嵌入式处理器的扩展：针对嵌入式系统的特殊需求，提供了一些优化的库函数和数据类型，如更小的内存占用、更快的执行速度等。
> - 动态内存扩展：提供了更灵活的动态内存管理功能，如智能指针、垃圾回收等。
> - 浮点扩展：提供了更强大的浮点运算支持，如高精度浮点数、复数运算等。
> - TR/TS 规格：TR（Technical Report）和 TS（Technical Specification）是 ISO 发布的技术报告和技术规范，用于描述实验性的或尚未正式纳入标准的功能。
> - 非 TS 提案：一些尚未被正式纳入标准但正在讨论中的提案，如新的库函数、语言特性等。
>

---

### 有用资源

| 有用的资源          | 内容                                                 |
| ------------------- | ---------------------------------------------------- |
| C 常见问题          | C FAQ                                                |
| C 语言和库参考      | JTC1/SC22/WG14，comp.std.c，GNU C 手册               |
| C ABI               | System V ABI，Windows x64 ABI，PowerPC EABI，ARM ABI |
| 相关标准            | POSIX.1-2024/IEEE 标准 1003.1-2024，Linux 手册页     |
| 开源实现            | 标准库实现 GNU libc/MUSL，编译器 GCC/LLVM            |
| 非 ANSI/ISO C库列表 | 包管理器，开源库                                     |

### 知识增强：有用资源详解

> **C 常见问题**
>
> - C FAQ：C FAQ 是一个关于 C 语言常见问题的问答集合，涵盖了语法、库函数、编译器、调试等方面的内容。它是学习 C 语言的重要参考资料。
>
> **C 语言和库参考**
>
> - JTC1/SC22/WG14：JTC1/SC22/WG14 是 ISO 的 C 语言标准化工作组，负责制定和维护 C 语言标准。
> - comp.std.c：comp.std.c 是一个 Usenet 新闻组，专门讨论 C 语言标准和相关问题。
> - GNU C 手册：GNU C 手册是 GNU 项目的官方文档，详细介绍了 GNU C 编译器的特性和用法。
>
> **C ABI**
>
> - System V ABI：System V ABI 是 Unix 系统的标准应用程序二进制接口，定义了程序如何与操作系统交互。
> - Windows x64 ABI：Windows x64 ABI 是 Windows 64 位系统的应用程序二进制接口，定义了程序如何与 Windows 操作系统交互。
> - PowerPC EABI：PowerPC EABI 是 PowerPC 架构的嵌入式应用程序二进制接口，适用于嵌入式系统。
> - ARM ABI：ARM ABI 是 ARM 架构的应用程序二进制接口，适用于 ARM 处理器。
>
> **相关标准**
>
> - POSIX.1-2024/IEEE 标准 1003.1-2024：POSIX 是 Portable Operating System Interface 的缩写，定义了操作系统应该提供的接口和服务。POSIX.1-2024 是最新的 POSIX 标准，适用于 Unix 和类 Unix 系统。
> - Linux 手册页：Linux 手册页是 Linux 系统的官方文档，详细介绍了系统调用、库函数、配置文件等内容。
>
> **开源实现**
>
> - 标准库实现 GNU libc/MUSL：GNU libc 是 GNU 项目的标准库实现，广泛用于 Linux 系统。MUSL 是一个轻量级的标准库实现，适用于嵌入式系统。
> - 编译器 GCC/LLVM：GCC 和 LLVM 是两个主流的开源编译器，支持多种编程语言，包括 C 和 C++。
>
> **非 ANSI/ISO C库列表**
>
> - 包管理器：包管理器用于管理和安装第三方库，如 `apt`、`yum`、`brew` 等。
> - 开源库：开源库是指公开源代码的库，如 `glibc`、`musl`、`libcurl` 等。
>

---

来源：[cppreference.com](https://en.cppreference.com/index.html)