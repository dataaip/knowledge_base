## Code Styleguide-ä¼˜é›…çš„ç¼–ç è§„èŒƒä¹‹æ–‡ä»¶ç»“æ„è§„èŒƒï¼ˆC/C++ç¯‡ï¼‰

å…³äºCode Styleguide-ä¼˜é›…çš„ç¼–ç è§„èŒƒ ç›®å‰å·²æ¢³ç†å®Œæˆäº†å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼š

- é¡¹ç›®ç›®å½•è§„èŒƒ
- æ–‡ä»¶ç»“æ„è§„èŒƒ
- ä»£ç ç¨‹åºè§„èŒƒ

å‰ä¸€éƒ¨åˆ†å·²è¯´æ˜é¡¹ç›®ç›®å½•è®¾è®¡è§„èŒƒï¼Œå»ºç«‹äº†é¡¹ç›®çš„åŸºæœ¬æ¡†æ¶ã€‚æ¥ä¸‹æ¥ï¼Œå°†é€šè¿‡è§„èŒƒåŒ–çš„æ–‡ä»¶è®¾è®¡ä¿è¯ä»£ç çš„å¥å£®æ€§ã€å¯è¯»æ€§å’Œå¯è¿›åŒ–èƒ½åŠ›ã€‚æ›´å¤šå¯ä»¥ç»†èŠ‚å¯ä»¥å‚è€ƒ [Google å¼€æºé¡¹ç›®é£æ ¼æŒ‡å—](https://zh-google-styleguide.readthedocs.io/en/latest/contents.html)ã€‚

### ä¸€ã€ç‰ˆæƒä¸ç‰ˆæœ¬å£°æ˜è§„èŒƒ

#### 1. å¿…è¦æ€§

æ³•å¾‹æŠ¤èº«ç¬¦ï¼šæ˜ç¡®ä»£ç æ‰€æœ‰æƒå½’å±ï¼ˆä¼ä¸šæ³•åŠ¡éƒ¨çš„åˆšéœ€ï¼‰
æŠ€æœ¯æ¡£æ¡ˆè¢‹ï¼šè®°å½•ä»£ç ä¿®æ”¹å†å²ï¼ˆæ¯” Git å†å²æ›´ç›´è§‚ï¼‰
å›¢é˜ŸåŠŸåŠ³ç°¿ï¼šæ ‡è¯†ä¸»è¦è´¡çŒ®è€…ï¼ˆç¨‹åºå‘˜çš„åç‰‡ï¼‰

#### 2. è§„èŒƒè¦ç‚¹

ç»å…¸BSDåè®®å£°æ˜-å¼€æºé¡¹ç›®æ ‡é…æ¨¡æ¿ï¼ˆé€‚åˆå¼€æºé¡¹ç›®ï¼‰
```c
/*
 * Copyright (c) 2023-2024, Your Name
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms...ï¼ˆè¯¦ç»†åè®®å†…å®¹ï¼‰
 */

// ç‰ˆæœ¬å…ƒæ•°æ®ï¼ˆGitè‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹ï¼‰
#pragma once
#define VERSION_MAJOR 1
#define VERSION_MINOR 4
#define GIT_HASH "0x8a3d2f1"
```

æ¨èæ ¼å¼ç¤ºä¾‹-ä¼ä¸šé¡¹ç›®å¢å¼ºç‰ˆ
```c
/********************************************************************  
 * Copyright (c) 2023-2024, Company Name                            *  
 * All rights reserved.                                             *  
 *                                                                  *  
 * Redistribution and use in source and binary forms, with or       *  
 * without modification, are permitted under BSD-3-Clause License.  *  
 * For full license text, see LICENSE.md in the project root.       *  
 ********************************************************************/  
 
// Version: 2.1.0  
// Author: Brightl Lau <brightl.lau@company.com>  
// Description: Core data structure implementation  
// Last Modified: 2024-02-20 by Brightl
```

#### 3. æœ€ä½³å®è·µ

ç‰ˆæƒä¸ç‰ˆæœ¬å£°æ˜ä½ç½®ä¸‰åŸåˆ™ï¼šå£°æ˜ä½ç½®å¿…é¡»ä½äºæ–‡ä»¶æœ€é¡¶éƒ¨ï¼Œä¿®æ”¹æ–‡ä»¶éœ€åŒæ­¥æ›´æ–°ä¿®æ”¹æ—¥æœŸï¼Œä¸åŒè®¸å¯è¯é¡¹ç›®ç¦æ­¢æ··åˆå£°æ˜æ ¼å¼

 - å¤´æ–‡ä»¶å¿…è£…ï¼šæ¯ä¸ª `.h` æ–‡ä»¶å¤´éƒ¨å¿…é¡»å®Œæ•´å£°æ˜ï¼Œå®Œæ•´ç‰ˆæƒå£°æ˜ï¼ˆæ‰€æœ‰è€…ã€æ—¥æœŸã€ç»´æŠ¤è€…ã€è®¸å¯è¯ï¼‰
 - æºæ–‡ä»¶æ ‡é…ï¼š`.cpp/.c` æ–‡ä»¶é¦–è¡Œæ·»åŠ å®Œæ•´å£°æ˜ï¼Œä¸å¤´æ–‡ä»¶ä¸€è‡´çš„å®Œæ•´å£°æ˜
 - ç‰¹æ®Šæ–‡ä»¶ä¾‹å¤–ï¼šå•å…ƒæµ‹è¯•ã€é…ç½®æ–‡ä»¶ç­‰å¯ç²¾ç®€ï¼Œä½†éœ€ä¿ç•™æ ¸å¿ƒä¿¡æ¯ï¼ˆç‰ˆæƒæ‰€æœ‰è€…ã€è®¸å¯è¯ï¼‰

å†…å®¹ç¼–æ’æ¨èæ ¼å¼ï¼š

```cpp
// ä¼ä¸šçº§æ¨¡æ¿ï¼ˆæ³•åŠ¡éƒ¨å®¡æ ¸é€šè¿‡ç‰ˆï¼‰
/********************************************************************
 * [æ³•å¾‹ç›¾ç‰Œ] 
 * ç‰ˆæƒæ‰€æœ‰ (c) 2024 æŸæŸç§‘æŠ€:å¼€æºé¡¹ç›®åè®®ï¼ˆ BSD/MIT/Apache ç­‰ï¼‰ã€ä¼ä¸šé¡¹ç›®ï¼šå¿…é¡»åŒ…å«æ ‡å‡†åŒ–ç‰ˆæƒå£°æ˜ï¼ˆæ³•åŠ¡éƒ¨é—¨å®¡æ ¸ï¼‰
 * ä¿ç•™æ‰€æœ‰æƒåˆ©ï¼Œä»£ç å—å•†ä¸šç§˜å¯†ä¿æŠ¤
 * 
 * [æŠ€æœ¯æ¡£æ¡ˆ]
 * æ–‡ä»¶ï¼šnetwork/http_server.cpp
 * æè¿°ï¼šé«˜æ€§èƒ½HTTPæœåŠ¡æ ¸å¿ƒå®ç°ï¼ˆTPS>10ä¸‡ï¼‰
 * ç‰ˆæœ¬ï¼šv2.3.1ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼‰ç‰ˆæœ¬ç®¡ç†æ·å¾„ï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬è‡ªåŠ¨å‡çº§
 * 
 * [è´¡çŒ®è€…åå•]
 * ä¸»ç¨‹ï¼šç‹å¼º <wangqiang@xxtech.com>
 * åä½œè€…ï¼š2024-03 æ›´æ–°æå¨œï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼ˆå¯è‡ªåŠ¨åŒ–ç”Ÿæˆï¼‰ 
 *          |_ é€šè¿‡ Git Co-authored-by è¿½è¸ª 
 ********************************************************************/
```

å·¥å…·æ¨èï¼š
- `clang-format` é…ç½®ï¼šç‰ˆæƒå£°æ˜ç‰¹æ®Šå¤„ç†ã€ä¿æŒæ³¨é‡Šå¯¹é½ï¼Œå¦‚è‡ªåŠ¨å¯¹é½æ˜Ÿå·ã€é™åˆ¶æ¯è¡Œå®½åº¦
- `Git Hooks` é…ç½®ï¼šè‡ªåŠ¨æ›´æ–°æœ€åä¿®æ”¹æ—¶é—´ã€è‡ªåŠ¨æ’å…¥è´¡çŒ®è€…æ ‡ç­¾

### äºŒã€å¤´æ–‡ä»¶ç»“æ„è®¾è®¡
å¤´æ–‡ä»¶æ˜¯æ¨¡å—çš„å¯¹å¤–å¥‘çº¦ï¼Œéœ€è¦ä¸¥æ ¼çš„è´¨é‡æ§åˆ¶

#### 1. é˜²å¾¡å¼ç¼–ç¨‹ç»“æ„è§„èŒƒ

```cpp
/*
 * Copyright (c) 2023-2024, Your Name
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms...ï¼ˆè¯¦ç»†åè®®å†…å®¹ï¼‰
 */

// mylib/algorithm/sort.h  
#ifndef MYLIB_ALGORITHM_SORT_H              // å”¯ä¸€å®å‘½åè§„åˆ™ï¼Œç¬¬ä¸€é“é˜²çº¿ï¼šå”¯ä¸€èº«ä»½ID
#define MYLIB_ALGORITHM_SORT_H  

#include <vector>                           // æ ‡å‡†åº“å¤´æ–‡ä»¶ï¼ˆåŸºç¡€å·¥å…·åŒ…ï¼‰    
#include "third_party/absl/time/time.h"     // ç¬¬ä¸‰æ–¹å¤´æ–‡ä»¶ï¼ˆç²¾é€‰å·¥å…·ç®±ï¼‰
#include "mylib/config.h"                   // é¡¹ç›®å¤´æ–‡ä»¶ï¼ˆè‡ªå®¶å·¥å…·ï¼‰

namespace mylib {                           // å‘½åç©ºé—´èµ·å§‹ä½ç½®  

// å‰ç½®å£°æ˜ï¼ˆä¼˜å…ˆäºåŒ…å«å¤´æ–‡ä»¶ï¼‰  
class DataProcessor;  

/// @brief é«˜æ€§èƒ½æ’åºæ¥å£ï¼ˆ Doxygen é£æ ¼æ³¨é‡Šï¼‰  
/// @tparam T å…ƒç´ ç±»å‹éœ€æ”¯æŒ<æ“ä½œç¬¦ï¼ˆå¥‘çº¦å¼è®¾è®¡ï¼‰
/// @param data è¾“å…¥/è¾“å‡ºæ•°æ®å‘é‡  
template <typename T>  
void hybrid_sort(std::vector<T>& data);  

/**
 * @class Vector
 * @brief ç±»å‹å®‰å…¨åŠ¨æ€æ•°ç»„ï¼ˆ Doxygen é£æ ¼æ³¨é‡Šï¼‰
 */
template <typename T>
class Vector {
public:
    explicit Vector(size_t capacity = 10);   // explicité¿å…éšå¼è½¬æ¢
    ~Vector();

    void push_back(const T& value);          // å¼‚å¸¸å®‰å…¨ä¿è¯ï¼šnothrow

private:
    T* data_;                                // å°¾ä¸‹åˆ’çº¿è¡¨ç¤ºæˆå‘˜å˜é‡
    size_t size_;
    size_t capacity_;
};

// æ¨¡æ¿å®ç°åˆ†ç¦»å¼å†™æ³•ï¼ˆä¿æŒæ¥å£æ¸…çˆ½ï¼‰- æ¨¡æ¿å®ç°å¿…é¡»æ”¾åœ¨å¤´æ–‡ä»¶
#include "detail/vector_impl.h"              // å®ç°åˆ†ç¦»æŠ€å·§

} // namespace mylib  

#endif // MYLIB_ALGORITHM_SORT_H  
```

#### 2. è®¾è®¡å‡†åˆ™

å¤´æ–‡ä»¶æœ€ä¸¥å®ˆå«ï¼š
- åŒé‡é˜²æŠ¤ï¼š`#pragma once` + `#ifndef` å®å®ˆå«
- å‘½åè§„èŒƒï¼šå”¯ä¸€å®å‘½å é¡¹ç›®_æ¨¡å—_æ–‡ä»¶å_Hï¼ˆå¦‚ `TECBLOG_ALGO_SORT_H` ï¼‰

æœ€æ´ç™–åŒ…å«é¡ºåºï¼š
- æ ‡å‡†åº“ -> ç³»ç»Ÿå¤´æ–‡ä»¶ -> ç¬¬ä¸‰æ–¹åº“ -> é¡¹ç›®å†…éƒ¨
- ç¦æ­¢å¤´æ–‡ä»¶æ··åˆåŒ…å«ä¼šå¯¼è‡´ä¾èµ–æ··ä¹±ï¼Œç¦æ­¢å¾ªç¯ä¾èµ–

æœ€ä¸¥æ ¼å‘½åç©ºé—´ï¼š
- ä½¿ç”¨åµŒå¥—å‘½åç©ºé—´ç®¡ç†ï¼ˆå¦‚ `techblog::algo::internal` ï¼‰
- ç¦æ­¢ `using namespace` æ±¡æŸ“å…¨å±€ï¼Œå¦‚ `using std::vector;`

æœ€ä¼˜é›…å¤´æ–‡ä»¶è®¾è®¡ï¼š
- å¤´æ–‡ä»¶ä¿æŒæ¥å£ç®€æ´ï¼ˆ â‰¤1000 è¡Œï¼‰ï¼Œå•ä¸ªå¤´æ–‡ä»¶è¡Œæ•°é™åˆ¶ï¼Œæå‡å¯è¯»æ€§
- æ¨¡æ¿ç±»/å‡½æ•°å£°æ˜ä¸å®ç°åˆ†ç¦»ï¼Œå¤´æ–‡ä»¶ä»…ä¿ç•™æ¥å£å£°æ˜ä¸å­˜æ”¾å®šä¹‰ï¼ˆæ¨¡æ¿ä»£ç éœ€åœ¨ç¼–è¯‘æœŸå¯è§ï¼Œ`.cpp`åˆ†ç¦»æ— æ³•æ»¡è¶³ï¼Œä½†å¯ä»¥åœ¨ä¸»æ–‡ä»¶å£°æ˜ï¼Œåœ¨ `_impl.h` å®ç°ï¼‰
-  å‰ç½®å£°æ˜æ›¿ä»£ä¸å¿…è¦çš„åŒ…å«ï¼Œé€šè¿‡å‰ç½®å£°æ˜å‡å°‘å¤´æ–‡ä»¶ä¾èµ–ï¼Œé¿å…"includeæ±¡æŸ“"
- æ˜¾å¼å®ä¾‹åŒ–é¿å…éšå¼å¯¼è‡´çš„å¤šå¤„é‡å¤ä»£ç ç”Ÿæˆï¼Œå‡å°‘æ¨¡æ¿å±•å¼€æ¬¡æ•°ï¼Œç¦æ­¢æ¨¡ç‰ˆå®šä¹‰åˆ†æ•£ï¼Œå£°æ˜ç½®äºå°¾éƒ¨
- å†…è”å‡½æ•°ï¼šç®€å•å‡½æ•°ï¼ˆâ‰¤5è¡Œï¼‰å¯å†…è”ï¼Œå¤æ‚é€»è¾‘å†…è”å½±å“ç¼–è¯‘é€Ÿåº¦
- PIMPL æ¨¡å¼é™ä½ç¼–è¯‘ä¾èµ–ï¼Œç”¨äºå®ç°ç¼–è¯‘é˜²ç«å¢™å’Œæ¥å£éš”ç¦»çš„è®¾è®¡æ¨¡å¼ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æŒ‡é’ˆå°†ç±»çš„å®ç°ç»†èŠ‚ä¸æ¥å£å£°æ˜å®Œå…¨è§£è€¦

æœ€æ™ºèƒ½æ–‡æ¡£ï¼š
- å…¬å…± API å¿…é¡»åŒ…å« Doxygen è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆæ³¨é‡Š
- å¥‘çº¦å¼æ³¨é‡Šï¼ˆå¦‚`@pre`ã€`@post`æ¡ä»¶ï¼‰ç¦æ­¢ "// å¤„ç†æ•°æ®"ï¼ˆæ— ä¿¡æ¯é‡æ³¨é‡Šï¼‰

æœ€å®‰å…¨å¯è§æ€§ï¼š
- ç§æœ‰æˆå‘˜ç”¨`_`åç¼€æ ‡è®°
- ç¦ç”¨`public`æˆå‘˜å˜é‡ï¼ˆå¿…é¡»é€šè¿‡æ¥å£è®¿é—®ï¼‰

#### 3. å®æˆ˜é¿å‘æŒ‡å—

å¾ªç¯åŒ…å«é™·é˜±
```cpp
// é”™è¯¯ç¤ºèŒƒï¼šå¤´æ–‡ä»¶äº’ç›¸åŒ…å«
// file_a.h
#include "file_b.h"  // âŒ

// file_b.h 
#include "file_a.h"  // âŒ

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å‰ç½®å£°æ˜æ‰“ç ´å¾ªç¯
// file_a.h
class B;  // âœ… å‰ç½®å£°æ˜ä»£æ›¿åŒ…å«

// file_b.h  
class A;  // âœ…
```

å‘½åç©ºé—´æ±¡æŸ“
```cpp
// å±é™©æ“ä½œï¼šæ‰“å¼€æ½˜å¤šæ‹‰é­”ç›’
using namespace std;  // ğŸ’€

// æ›¿ä»£æ–¹æ¡ˆ
using std::vector;  // âœ… ç²¾å‡†å¯¼å…¥
```

å¤´æ–‡ä»¶è†¨èƒ€ç—‡ï¼š
- ç—‡çŠ¶ï¼šå•ä¸ªå¤´æ–‡ä»¶è¶…è¿‡ 1000 è¡Œ
- è¯æ–¹ï¼šä½¿ç”¨ `detail` ç›®å½•å­˜æ”¾å®ç°ç»†èŠ‚

#### 4. å·¥å…·é“¾æ¨è

åŒ…å«å…³ç³»åˆ†æï¼šä½¿ç”¨ include-what-you-use æ£€æŸ¥å†—ä½™åŒ…å«`iwyu -Xiwyu --check_also=techblog/*.h your_file.cpp`
å¤´æ–‡ä»¶å¥åº·æ£€æŸ¥ï¼šæ£€æŸ¥å¤´æ–‡ä»¶ç‹¬ç«‹æ€§ `g++ -H -E techblog/algorithm/sort.h 2>&1 | grep '^\.'`
æ–‡æ¡£è‡ªåŠ¨åŒ–ï¼šç”Ÿæˆ Doxygen æ–‡æ¡£ `doxygen Doxyfile && open html/index.html`

#### 5. å¤´æ–‡ä»¶å“²å­¦

è®°ä½ï¼šä½ ä»Šå¤©å†™çš„å¤´æ–‡ä»¶ï¼Œå¯èƒ½æ­£åœ¨å®šä¹‰åå¹´åçš„ç³»ç»Ÿæ¶æ„ï¼ä¼˜ç§€çš„å¤´æ–‡ä»¶åº”è¯¥åƒç²¾å¿ƒè®¾è®¡çš„APIåˆåŒï¼š
- æ˜ç¡®æ€§ï¼šæ¯ä¸ªæ¥å£éƒ½æœ‰æ¸…æ™°çš„è¾“å…¥è¾“å‡ºçº¦å®š
- ç¨³å®šæ€§ï¼šä¿®æ”¹æ¥å£éœ€è¦ç»è¿‡ä¸¥æ ¼è¯„å®¡
- æ‰©å±•æ€§ï¼šé€šè¿‡æ¨¡æ¿å’Œç»§æ‰¿æ”¯æŒæœªæ¥æ¼”è¿›

### ä¸‰ã€æºæ–‡ä»¶ç»“æ„

#### 1. æ ‡å‡†åŒ–å®ç°ç»“æ„

```cpp
/*
 * Copyright (c) 2023-2024, Your Name
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms...ï¼ˆè¯¦ç»†åè®®å†…å®¹ï¼‰
 */

// mylib/algorithm/sort.cpp  
#include "mylib/algorithm/sort.h" // ä¼˜å…ˆåŒ…å«å…³è”å¤´æ–‡ä»¶  
 
#include <algorithm>            // æ ‡å‡†åº“  
#include "mylib/utils.h"        // é¡¹ç›®å†…éƒ¨

namespace mylib {

// åŒ¿åå‘½åç©ºé—´å°è£…å®ç°ç»†èŠ‚  
namespace {  

constexpr size_t MIN_CAPACITY = 8;  // å¸¸é‡å…¨å¤§å†™ 
  
template <typename T>   // å†…éƒ¨è¾…åŠ©å‡½æ•°ä¸æš´éœ²  
void insertion_sort(typename std::vector<T>::iterator begin,   
                   typename std::vector<T>::iterator end) {  
  // å®ç°ç»†èŠ‚...  
}  

static void* allocate(size_t bytes) { // é™æ€å‡½æ•°é™ä½ç¬¦å·æ±¡æŸ“
    return detail::aligned_alloc(bytes);  // è°ƒç”¨å†…éƒ¨å·¥å…·
}

} // namespace  

//=== å†…å­˜å‡†å¤‡åŒº ===//
Vector::Vector(size_t capacity) 
    : data_(static_cast<T*>(allocate(capacity * sizeof(T))) {}

Vector::Vector(size_t capacity) 
    : data_(std::make_unique<T[]>(capacity)) {}  // ç°ä»£C++å®‰å…¨æŒ‡é’ˆ

//=== æ ¸å¿ƒæ“ä½œåŒº ===//
void Vector::push_back(const T& value) {
    if (size_ >= capacity_) {
        // å¼‚å¸¸å®‰å…¨çš„å†…å­˜æ‰©å®¹
        detail::safe_realloc(data_, capacity_ * 2);
    }
    new (&data_[size_++]) T(value);  // ç²¾å‡†æ¤å…¥
}
  
//=== ç‰¹æ®Šå¤„ç†åŒº ===//
template void hybrid_sort<int>(std::vector<int>& data);       // æ¨¡æ¿æ˜¾å¼å®ä¾‹åŒ–
template void hybrid_sort<double>(std::vector<double>& data);  

#ifdef UNIT_TEST  // ä¾›æµ‹è¯•ä½¿ç”¨çš„è§‚å¯Ÿçª—
friend class VectorTest;
#endif

} // namespace mylib  
```

#### 2. æ ¸å¿ƒè§„èŒƒ

åŒ…å«é¡ºåºï¼š
- åŒ¹é…çš„å¤´æ–‡ä»¶ï¼ˆå¦‚ `vector.h`ï¼‰
- æ ‡å‡†åº“ã€ç³»ç»Ÿå¤´æ–‡ä»¶
- ç¬¬ä¸‰æ–¹åº“å¤´æ–‡ä»¶
- é¡¹ç›®å†…éƒ¨å¤´æ–‡ä»¶

å®ç°ç­–ç•¥ï¼š
- ä½¿ç”¨åŒ¿åå‘½åç©ºé—´éšè—å†…éƒ¨å‡½æ•°å®ç°ç»†èŠ‚
- é™æ€å‡½æ•°ä¼˜äºå…¨å±€å‡½æ•°ï¼Œä½¿ç”¨ `static` å‡½æ•°é™åˆ¶ä½œç”¨åŸŸ
- å®ç°ä¸å£°æ˜åˆ†ç¦»ï¼Œå¤æ‚æ¨¡æ¿ç‰¹åŒ–åœ¨ `.cpp` ä¸­æ˜¾å¼å®ä¾‹åŒ–

å†…å­˜ç®¡ç†ï¼š
- `new/delete` é…å¯¹ä½¿ç”¨ 
- è‡ªå®šä¹‰åˆ†é…å™¨ç»Ÿä¸€ç®¡ç†
- `RAII` å®‰å…¨æœºåˆ¶ï¼Œä½¿ç”¨ `RAII` åŒ…è£…èµ„æº

å¯æµ‹è¯•æ€§è®¾è®¡ï¼š
- ä½¿ç”¨ `friend class TestClassName` æš´éœ²æµ‹è¯•æ¥å£
- æ–‡ä»¶æœ«å°¾æ·»åŠ  `#ifdef UNIT_TEST` æµ‹è¯•ç”¨ä¾‹

é”™è¯¯å¤„ç†è§„èŒƒï¼š
- è¿”å›é”™è¯¯ç ä¼˜å…ˆäºå¼‚å¸¸ï¼ˆç³»ç»Ÿç¼–ç¨‹åœºæ™¯ï¼‰
- å¼‚å¸¸å®‰å…¨ç­‰çº§æ ‡æ³¨ï¼ˆå¦‚ `Basic/Strong/Nothrow` ï¼‰

#### 3. ä»£ç åˆ†åŒºç­–ç•¥

```cpp
/*
 * Copyright (c) 2023-2024, Your Name
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms...ï¼ˆè¯¦ç»†åè®®å†…å®¹ï¼‰
 */

/**********************************************  
 *               åˆ†åŒºæ ‡è¯†å»ºè®®                  *  
 **********************************************/  

//===----------------------------------------------------------------------===//  
// ç±»å‹å®šä¹‰åŒº  
//===----------------------------------------------------------------------===//  

struct InternalConfig {  
  int version;  
  bool debug;  
};  

//===----------------------------------------------------------------------===//  
// è¾…åŠ©å‡½æ•°åŒº  
//===----------------------------------------------------------------------===//  

namespace {  

void validate_config(const InternalConfig& cfg) {  
  // ...  
}  

}  

//===----------------------------------------------------------------------===//  
// ä¸»é€»è¾‘åŒº  
//===----------------------------------------------------------------------===//  

void PublicAPI::execute() {  
  // ä¸»æµç¨‹...  
}  
```

#### 5. æ€§èƒ½ä¼˜åŒ–ç§˜ç±

çƒ­ç‚¹æ ‡æ³¨æ³•
```cpp
void critical_path() {
  // [PERF] éœ€è¦ä¼˜åŒ–çš„çƒ­ç‚¹è·¯å¾„
  // å½“å‰è€—æ—¶ï¼š2.3msï¼ˆåŸºå‡†æµ‹è¯•æ•°æ®ï¼‰
}
```

å†…å­˜å¯¹é½æŠ€å·§
```cpp
struct alignas(64) CacheLine {
  // ç¼“å­˜è¡Œå¯¹é½ç»“æ„ä½“
};
```

SIMDåŠ é€Ÿ
```cpp
#include <immintrin.h>
void simd_add(float* a, float* b) {
    __m256 va = _mm256_load_ps(a);
    __m256 vb = _mm256_load_ps(b);
    _mm256_store_ps(a, _mm256_add_ps(va, vb));
}
```

#### 6. å·¥å…·é“¾æ¨è

å†…å­˜æ£€æµ‹ä»ªï¼š`valgrind --leak-check=full ./your_program`
æ€§èƒ½åˆ†æå™¨ï¼š`perf record -g ./your_program && perf report`
ä»£ç æ ¼å¼åŒ–ï¼š`clang-format -i --style=file src/*.cpp`

#### 7. ç»“è¯­ï¼šä»£ç å¦‚æ‰‹æœ¯

è®°ä½ï¼šä½ å†™çš„æ¯ä¸ªæºæ–‡ä»¶ï¼Œéƒ½æ˜¯åœ¨ä¸ºä»£ç åº“åšä¸€åœºç²¾å¯†æ‰‹æœ¯ï¼ä¼˜ç§€çš„æºæ–‡ä»¶åº”è¯¥åƒè§„èŒƒçš„æ‰‹æœ¯å®¤ï¼š
- éš”ç¦»æ€§ï¼šé€šè¿‡å‘½åç©ºé—´å’Œè®¿é—®æ§åˆ¶éš”ç¦»æ±¡æŸ“
- ç»“æ„åŒ–ï¼šä»£ç åˆ†åŒºæ˜ç¡®ï¼Œå·¥å…·å„å¸å…¶èŒ
- èµ„æºç®¡ç†ï¼šRAII æœºåˆ¶ä¿éšœèµ„æºå®‰å…¨
- å¯éªŒè¯æ€§ï¼šå®Œå–„çš„æµ‹è¯•å’Œæ€§èƒ½åˆ†æ

### å››ã€æµ‹è¯•æ–‡ä»¶ç»“æ„è§„èŒƒ

#### 1. æµ‹è¯•æ–‡ä»¶ç»“æ„ç¤ºä¾‹

```cpp
/*
 * Copyright (c) 2023-2024, Your Name
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms...ï¼ˆè¯¦ç»†åè®®å†…å®¹ï¼‰
 */

// tests/algorithm/sort_test.cpp  
#include "gtest/gtest.h"            // æµ‹è¯•æ¡†æ¶
#include "mylib/algorithm/sort.h"   // è¢«æµ‹å¯¹è±¡

namespace mylib {  
namespace test {                    // æµ‹è¯•ä¸“å±ç©ºé—´

// åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆåŠŸèƒ½å¿ƒç”µå›¾ï¼‰
TEST(SortTest, IntVectorSort) {  
  std::vector<int> data = {3, 1, 4, 1, 5};  
  hybrid_sort(data);  
  ASSERT_EQ(data, std::vector<int>({1, 1, 3, 4, 5}));  
}  

// å‹åŠ›æµ‹è¯•ï¼ˆæé™æ‰¿é‡è¯•éªŒï¼‰
TEST(SortTest, LargeDataSet) {  
  constexpr int kSize = 1'000'000;  
  std::vector<int> data(kSize);  
  std::generate(data.begin(), data.end(), std::rand);  
  hybrid_sort(data);  
  ASSERT_TRUE(std::is_sorted(data.begin(), data.end()));  
}  

} // namespace test  
} // namespace mylib  
```

#### 2. æµ‹è¯•æ–‡ä»¶åŸåˆ™

é•œåƒç»“æ„ï¼š `tests/`ç›®å½•ä¸`src/`ä¿æŒç›¸åŒå±‚çº§
æµ‹è¯•åˆ†ç±»ï¼šUnitï¼šå•ä¸€åŠŸèƒ½ç‚¹æµ‹è¯•ã€Integrationï¼šè·¨æ¨¡å—äº¤äº’æµ‹è¯•ã€Benchmarkï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•
Mock ç­–ç•¥ï¼šä½¿ç”¨ Google Mock æ›¿æ¢å¤–éƒ¨ä¾èµ–ã€æ–‡ä»¶ I/O ç­‰æ“ä½œä½¿ç”¨å†…å­˜è™šæ‹ŸåŒ–

#### 3. æµ‹è¯•å·¥å…·ç™¾å®ç®±

è¦†ç›–ç‡æ£€æµ‹ï¼š
```bash
gcov -b your_program  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
lcov --capture --directory . --output-file coverage.info  # å¯è§†åŒ–
```

æ€§èƒ½æµ‹è¯•ï¼š
```cpp
// Google Benchmarkç¤ºä¾‹
static void BM_Sort(benchmark::State& state) {
    std::vector<int> data(state.range(0));
    for (auto _ : state) {
        hybrid_sort(data);
    }
}
BENCHMARK(BM_Sort)->Arg(1000)->Arg(1000000);
```

å¼‚å¸¸æ³¨å…¥ï¼š
```cpp
TEST(NetworkTest, ConnectionFailure) {
  EXPECT_DEATH({
      connect_to_server("invalid_ip");  // é¢„æœŸå´©æºƒæµ‹è¯•
  }, "Connection timeout");
}
```

#### 4. æµ‹è¯•ä¹‹é“

è®°ä½ï¼šæ¯ä¸ªé€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹ï¼Œéƒ½æ˜¯å¯¹ä»£ç è´¨é‡çš„ä¸€æ¬¡è®¤è¯ã€‚ä¼˜ç§€çš„æµ‹è¯•ä½“ç³»åº”è¯¥åƒç²¾å¿ƒç¼–ç»‡çš„å®‰å…¨ç½‘ï¼š
- å¯†åº¦é€‚ä¸­ï¼šå…³é”®è·¯å¾„100%è¦†ç›–ï¼Œæ¬¡è¦è·¯å¾„åˆç†å–èˆ
- å±‚æ¬¡åˆ†æ˜ï¼šå•å…ƒæµ‹è¯•å¿«é€Ÿåé¦ˆï¼Œé›†æˆæµ‹è¯•ä¿éšœäº¤äº’
- æŒç»­è¿›åŒ–ï¼šæµ‹è¯•ç”¨ä¾‹éšéœ€æ±‚è¿­ä»£æ›´æ–°

### äº”ã€ç»“è¯­ï¼šä»£ç å¦‚è¯—

æ–‡ä»¶ç»“æ„çš„å“²å­¦ï¼Œä¼˜ç§€çš„æ–‡ä»¶ç»“æ„è®¾è®¡åº”å®ç°ï¼š

- å¯è¯»æ€§ï¼šæ— éœ€è¿‡å¤šæ³¨é‡Šå³å¯ç†è§£ä»£ç ç»„ç»‡é€»è¾‘
- å¯ç»´æŠ¤æ€§ï¼šä¿®æ”¹å±€éƒ¨ä»£ç ä¸å½±å“å…¨å±€ç»“æ„
- å¯æ‰©å±•æ€§ï¼šæ–°å¢åŠŸèƒ½å¯æ‰¾åˆ°æ˜ç¡®å½’å±ä½ç½®
- å¯éªŒè¯æ€§ï¼šæµ‹è¯•ä»£ç ä¸å®ç°ä»£ç å…±ç”Ÿæ¼”è¿›

é€šè¿‡è§„èŒƒçš„æ–‡ä»¶ç»“æ„ï¼Œè®©ä»£ç åº“æˆä¸ºè‡ªæˆ‘é˜è¿°çš„è‰ºæœ¯å“ï¼Œè€Œééœ€è¦ç ´è¯‘çš„å¯†ç ã€‚
